---
apiVersion: formol.desmojim.fr/v1alpha1
kind: BackupConfiguration
metadata:
  name: backup-demo
  namespace: demo
spec:
  suspend: true
  image: desmo999r/formolcli:latest
  repository: repo-minio
  schedule: "15 * * * *"
  targets:
  - kind: Sidecar
    apiVersion: v1
    name: nginx-deployment
    steps:
      - name: maintenance-on
      - name: maintenance-off
        finalize: true
    volumeMounts:
      - name: demo-data
        mountPath: /data
    paths:
      - /data
  - kind: Job
    name: backup-pg
    steps:
      - name: backup-pg
        env:
          - name: PGHOST
            value: postgres
          - name: PGDATABASE
            value: demopostgres
          - name: PGUSER
            value: demopostgres
          - name: PGPASSWD
            value: password123!
  keep:
    last: 5
    daily: 2
    weekly: 2
    monthly: 6
    yearly: 3
